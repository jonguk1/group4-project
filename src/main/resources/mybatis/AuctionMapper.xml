<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lend.shareservice.domain.auction.AuctionMapper">

    <select id="selectAuctionByBoardId" parameterType="_int" resultType="com.lend.shareservice.entity.Auction">
        SELECT * FROM AUCTION
        WHERE boardId = #{boardId}
    </select>

    <insert id="insertAuction" parameterType="com.lend.shareservice.entity.Auction">
        <selectKey keyProperty="auctionId" resultType="java.lang.Integer" order="AFTER" keyColumn="auctionId">
            SELECT LAST_INSERT_ID()
        </selectKey>
        INSERT INTO AUCTION (currentPrice, regDate, maxPrice, boardId, userId)
        VALUES (0, NOW(), #{maxPrice}, #{boardId}, null)
    </insert>

    <select id="selectAuctionId" parameterType="com.lend.shareservice.entity.Auction" resultType="com.lend.shareservice.entity.Auction">
        SELECT * FROM AUCTION
        WHERE boardId = #{boardId}
    </select>

    <insert id="insertAuctionParticipant" parameterType="com.lend.shareservice.entity.Participant_Auction">
        INSERT INTO participant_auction (userId, auctionId)
        VALUES (#{userId}, #{auctionId})
    </insert>

    <select id="selectMaxPrice" parameterType="com.lend.shareservice.entity.Auction" resultType="com.lend.shareservice.entity.Auction">
        SELECT maxPrice FROM BOARD
        WHERE boardId = #{boardId}
    </select>

    <select id="selectIsAuctionById" parameterType="string" resultType="_int">
        SELECT COUNT(*)
        FROM Participant_Auction
        WHERE userId = #{userId}
    </select>

    <select id="selectParticipantCnt" parameterType="com.lend.shareservice.entity.Auction" resultType="_int">
        SELECT COUNT(*)
        FROM Participant_Auction
        WHERE auctionId = #{auctionId}
    </select>

    <select id="selectIdsByAuctionId" parameterType="Integer" resultType="java.lang.String">
        SELECT userId
        FROM Participant_Auction
        WHERE auctionId = #{auctionId}
    </select>
</mapper>